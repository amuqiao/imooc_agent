## ä¸€ã€åŸºç¡€é…ç½®ä¿¡æ¯

### 1. å¯†é’¥ä¿¡æ¯

```python
accessKeyId = "your_access_key_id"
accessKeySecret = "your_access_key_secret"

```

### 2. çŸ¥è¯†åº“é…ç½®

```python
# çŸ¥è¯†åº“ID
knowledge_base_id = "your_knowledge_base_id"

```

### 3. ä¸šåŠ¡ç©ºé—´é…ç½®

```python
# ä¸šåŠ¡ç©ºé—´ID
workspace_id = "your_workspace_id"
# agentKey
agentKey = "your_agent_key"
# ä¸šåŠ¡ç©ºé—´åˆ›å»ºæ—¶é—´
workspace_create_time = "2025-03-24 23:38:04"

```

## äºŒã€åˆ›å»ºç™¾ç‚¼å®¢æˆ·ç«¯

### 3.1 å®‰è£…ä¾èµ–

```bash
uv pip install alibabacloud_bailian20231229==2.8.1
uv add alibabacloud_bailian20231229==2.8.1

```

> å‚è€ƒæ–‡æ¡£ï¼šhttps://api.aliyun.com/api-tools/sdk/bailian?spm=a2c4g.11186623.0.0.679921f9n8F8og&version=2023-12-29&language=python-tea&tab=primer-doc


### 3.2 ç”Ÿæˆç™¾ç‚¼å®¢æˆ·ç«¯å®ä¾‹

```python
import os

from alibabacloud_tea_openapi import models as open_api_models
from alibabacloud_bailian20231229 import client as bailian_20231229_client

os.environ['ALIBABA_CLOUD_ACCESS_KEY_ID'] = "your_access_key_id"
os.environ['ALIBABA_CLOUD_ACCESS_KEY_SECRET'] = "your_access_key_secret"

def create_client() -> bailian_20231229_client.Client:
    config = open_api_models.Config(
        access_key_id=os.environ.get('ALIBABA_CLOUD_ACCESS_KEY_ID'),
        access_key_secret=os.environ.get('ALIBABA_CLOUD_ACCESS_KEY_SECRET')
    )
    config.endpoint = 'bailian.cn-beijing.aliyuncs.com'
    return bailian_20231229_client.Client(config=config)

```

## ä¸‰ã€æŸ¥è¯¢ç™¾ç‚¼çŸ¥è¯†åº“

### 4.1 ç™¾ç‚¼çŸ¥è¯†åº“æŸ¥è¯¢é€šç”¨æ–¹æ³•

```python
from alibabacloud_bailian20231229 import models as bailian_20231229_models
from alibabacloud_tea_util import models as util_models

os.environ['WORKSPACE_ID'] = "your_workspace_id"
os.environ['INDEX_ID'] = "your_index_id"

def retrieve_index(client, workspace_id, index_id, query):
    """
    åœ¨æŒ‡å®šçš„çŸ¥è¯†åº“ä¸­æ£€ç´¢ä¿¡æ¯ã€‚

    å‚æ•°:
        client (bailian_20231229_client.Client): å®¢æˆ·ç«¯ï¼ˆClientï¼‰ã€‚
        workspace_id (str): ä¸šåŠ¡ç©ºé—´IDã€‚
        index_id (str): çŸ¥è¯†åº“IDã€‚
        query (str): åŸå§‹è¾“å…¥promptã€‚

    è¿”å›:
        é˜¿é‡Œäº‘ç™¾ç‚¼æœåŠ¡çš„å“åº”ã€‚
    """
    headers = {}
    retrieve_request = bailian_20231229_models.RetrieveRequest(
        index_id=index_id,
        query=query
    )
    runtime = util_models.RuntimeOptions()
    return client.retrieve_with_options(workspace_id, retrieve_request, headers, runtime)

```

### 4.2 åˆ†æ®µæŸ¥è¯¢çŸ¥è¯†åº“

```python
os.environ['WORKSPACE_ID'] = "your_workspace_id"
os.environ['INDEX_ID'] = "your_index_id"

def query_rag_from_bailian(query):
    bailian_client = create_client()
    rag = retrieve_index(bailian_client, os.environ['WORKSPACE_ID'], os.environ['INDEX_ID'], query)

    result = ""
    index = 1
    for data in rag.body.data.nodes:
        result += f"""ç¬¬{index}æ®µçŸ¥è¯†ï¼š
    {data.text}
    --
    """
        index += 1

    print(result)
    return result

```

## å››ã€æ™ºèƒ½ä½“çŸ¥è¯†åº“å·¥å…·ğŸ¤–

### æ­¥éª¤1ï¼šå°è£…mcpå·¥å…·

```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP()

@mcp.tool(name="query_rag_from_bailian", description="ä»ç™¾ç‚¼å¹³å°æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œä¼ å…¥éœ€è¦æŸ¥è¯¢çš„çŸ¥è¯†å…³é”®å­—å³å¯")
def query_rag_from_bailian(query):
    # å®ç°åŒä¸Š

if __name__ == '__main__':
    mcp.run(transport="stdio")

```

### æ­¥éª¤2ï¼šç”Ÿæˆlangchainå·¥å…·

```python
from app.utils.mcp import create_mcp_stdio_client

async def get_stdio_rag_tools():
    params = {
        "command": "python",
        "args": [
            "/Users/sam/Xiaoluyy/ai/coding_agent/app/mcp/rag.py",
        ],
    }

    client, tools = await create_mcp_stdio_client("rag", params)

    return tools

```
